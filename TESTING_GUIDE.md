# ğŸ§ª VideoSite åŠŸèƒ½æµ‹è¯•æŒ‡å—

æœ¬æŒ‡å—å¸®åŠ©æ‚¨åœ¨å¼€å‘ç¯å¢ƒä¸­æµ‹è¯•æ–°å¢çš„æ”¯ä»˜è®¢é˜…ç³»ç»Ÿå’Œå­£åº¦ç®¡ç†åŠŸèƒ½ã€‚

## ğŸ“‹ æµ‹è¯•å‰å‡†å¤‡

### 1. å¯åŠ¨åŸºç¡€è®¾æ–½
```bash
# ç¡®è®¤ PostgreSQL, Redis, MinIO æ­£åœ¨è¿è¡Œ
docker ps | grep -E "postgres|redis|minio"

# å¦‚æœæœªè¿è¡Œï¼Œå¯åŠ¨å®ƒä»¬
cd /home/eric/video
docker-compose -f docker-compose.dev.yml up -d
```

### 2. è¿è¡Œæ•°æ®åº“è¿ç§»
```bash
cd backend
source venv/bin/activate
alembic upgrade head
```

### 3. åˆå§‹åŒ–æµ‹è¯•æ•°æ®
```bash
# åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
python scripts/init_data.py

# å¯é€‰ï¼šå¯¼å…¥æ”¯ä»˜ç³»ç»Ÿæµ‹è¯•æ•°æ®
python scripts/seed_payment_data.py
```

### 4. å¯åŠ¨åç«¯æœåŠ¡
```bash
# Terminal 1
cd backend
source venv/bin/activate
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 5. å¯åŠ¨å‰ç«¯æœåŠ¡
```bash
# Terminal 2 - Admin Frontend
cd admin-frontend
pnpm run dev  # è¿è¡Œåœ¨ http://localhost:5173 (proxies to :3001)

# Terminal 3 - User Frontend
cd frontend
pnpm run dev  # è¿è¡Œåœ¨ http://localhost:5173 (proxies to :3000)
```

---

## ğŸ§ª åŠŸèƒ½æµ‹è¯•æ¸…å•

### A. æ”¯ä»˜è®¢é˜…ç³»ç»Ÿæµ‹è¯•

#### A1. è®¢é˜…è®¡åˆ’ç®¡ç†ï¼ˆAdminï¼‰

**å‰ç½®æ¡ä»¶ï¼š**
- ç®¡ç†å‘˜è´¦å·ç™»å½• admin-frontend

**æµ‹è¯•æ­¥éª¤ï¼š**
1. å¯¼èˆªåˆ° ã€ŒğŸ’³ Paymentã€â†’ã€ŒSubscription Plansã€
2. éªŒè¯é¡µé¢æ˜¾ç¤ºè®¢é˜…è®¡åˆ’åˆ—è¡¨
3. ç‚¹å‡»ã€Œåˆ›å»ºè®¢é˜…è®¡åˆ’ã€æŒ‰é’®
4. å¡«å†™è¡¨å•ï¼š
   - Name (EN): Premium Monthly
   - Name (ZH): é«˜çº§æœˆåº¦å¥—é¤
   - Billing Period: Monthly
   - Price (USD): 9.99
   - Max Video Quality: 1080p
   - Max Concurrent Streams: 2
   - Features: [å‹¾é€‰] Allow Downloads, Ads Free
5. æäº¤è¡¨å•
6. éªŒè¯æ–°è®¡åˆ’å‡ºç°åœ¨åˆ—è¡¨ä¸­

**TODO(human): åœ¨æ­¤å®ç°è®¢é˜…è®¡åˆ’åˆ é™¤æµ‹è¯•**
```
æ­¥éª¤ï¼š
1. é€‰æ‹©åˆšåˆ›å»ºçš„æµ‹è¯•è®¡åˆ’
2. ç‚¹å‡»åˆ é™¤æŒ‰é’®
3. ç¡®è®¤åˆ é™¤
4. éªŒè¯è®¡åˆ’å·²ä»åˆ—è¡¨ä¸­ç§»é™¤

é¢„æœŸç»“æœï¼š
- [ ] åˆ é™¤æˆåŠŸ
- [ ] åˆ—è¡¨å·²æ›´æ–°
- [ ] æ˜¾ç¤ºæˆåŠŸæç¤º
```

#### A2. ä¼˜æƒ åˆ¸ç®¡ç†ï¼ˆAdminï¼‰

**æµ‹è¯•æ­¥éª¤ï¼š**
1. å¯¼èˆªåˆ° ã€ŒğŸ’³ Paymentã€â†’ã€ŒCouponsã€
2. ç‚¹å‡»ã€Œåˆ›å»ºä¼˜æƒ åˆ¸ã€
3. å¡«å†™ï¼š
   - Code: TEST20
   - Description: æµ‹è¯•ä¼˜æƒ åˆ¸
   - Discount Type: Percentage
   - Discount Value: 20
   - Valid From: 2025-01-01
   - Status: Active
4. æäº¤å¹¶éªŒè¯åˆ›å»ºæˆåŠŸ

**TODO(human): å®ç°ä¼˜æƒ åˆ¸éªŒè¯æµ‹è¯•**
```
æµ‹è¯•ä¼˜æƒ åˆ¸éªŒè¯é€»è¾‘ï¼š
1. åˆ›å»ºä¸€ä¸ªæœ‰æœ€ä½æ¶ˆè´¹è¦æ±‚çš„ä¼˜æƒ åˆ¸ï¼ˆMin Purchase: $50ï¼‰
2. å°è¯•åœ¨è®¢é˜… $9.99 å¥—é¤æ—¶ä½¿ç”¨
3. åº”è¯¥æ˜¾ç¤ºé”™è¯¯ï¼šã€Œä¸ç¬¦åˆæœ€ä½æ¶ˆè´¹è¦æ±‚ã€

é¢„æœŸç»“æœï¼š
- [ ] éªŒè¯é€»è¾‘æ­£ç¡®
- [ ] é”™è¯¯ä¿¡æ¯æ¸…æ™°
- [ ] UI åé¦ˆå‹å¥½
```

#### A3. æ”¯ä»˜è®°å½•æŸ¥çœ‹ï¼ˆAdminï¼‰

**æµ‹è¯•æ­¥éª¤ï¼š**
1. å¯¼èˆªåˆ° ã€ŒğŸ’³ Paymentã€â†’ã€ŒPaymentsã€
2. æŸ¥çœ‹æ”¯ä»˜è®°å½•åˆ—è¡¨
3. ä½¿ç”¨ç­›é€‰å™¨ï¼ˆæŒ‰çŠ¶æ€ã€æ—¥æœŸï¼‰
4. éªŒè¯æ’åºåŠŸèƒ½
5. å¯¼å‡º CSVï¼ˆå¦‚æœå·²å®ç°ï¼‰

---

### B. å­£åº¦/å‰§é›†ç®¡ç†æµ‹è¯•

#### B1. åˆ›å»ºç”µè§†å‰§å­£åº¦ï¼ˆAdminï¼‰

**å‰ç½®æ¡ä»¶ï¼š**
- å·²æœ‰ä¸€ä¸ªç”µè§†å‰§ç±»å‹çš„ Series

**æµ‹è¯•æ­¥éª¤ï¼š**
1. å¯¼èˆªåˆ°ã€ŒSeriesã€â†’ é€‰æ‹©ä¸€ä¸ªç”µè§†å‰§
2. ç‚¹å‡»ã€ŒSeasonsã€æ ‡ç­¾
3. ç‚¹å‡»ã€Œåˆ›å»ºå­£åº¦ã€
4. å¡«å†™ï¼š
   - Season Number: 1
   - Title: ç¬¬ä¸€å­£ï¼šå‡›å†¬å°†è‡³
   - Status: Draft
   - VIP Required: å¦
5. æäº¤å¹¶éªŒè¯

**TODO(human): å®ç°å‰§é›†æ·»åŠ æµ‹è¯•**
```
åœ¨åˆšåˆ›å»ºçš„å­£åº¦ä¸‹æ·»åŠ å‰§é›†ï¼š
1. è¿›å…¥ Season è¯¦æƒ…é¡µ
2. ç‚¹å‡»ã€Œæ·»åŠ å‰§é›†ã€
3. å¡«å†™å‰§é›†ä¿¡æ¯ï¼š
   - Episode Number: 1
   - Title: ç¬¬ä¸€é›†
   - Video ID: [é€‰æ‹©ä¸€ä¸ªè§†é¢‘]
   - Is Free: æ˜¯
4. æäº¤

é¢„æœŸç»“æœï¼š
- [ ] å‰§é›†åˆ›å»ºæˆåŠŸ
- [ ] æ˜¾ç¤ºåœ¨å­£åº¦å‰§é›†åˆ—è¡¨ä¸­
- [ ] å­£åº¦çš„ total_episodes æ•°é‡æ›´æ–°
```

#### B2. æ‰¹é‡å‘å¸ƒå­£åº¦ï¼ˆAdminï¼‰

**æµ‹è¯•æ­¥éª¤ï¼š**
1. åœ¨ Seasons åˆ—è¡¨ä¸­é€‰æ‹©å¤šä¸ªè‰ç¨¿çŠ¶æ€çš„å­£åº¦
2. ç‚¹å‡»ã€Œæ‰¹é‡å‘å¸ƒã€æŒ‰é’®
3. ç¡®è®¤æ“ä½œ
4. éªŒè¯æ‰€æœ‰é€‰ä¸­å­£åº¦çŠ¶æ€å˜ä¸ºã€Œå·²å‘å¸ƒã€

---

### C. å¤šè¯­è¨€æ”¯æŒæµ‹è¯•

#### C1. è¯­è¨€åˆ‡æ¢æµ‹è¯•

**æµ‹è¯•æ­¥éª¤ï¼š**
1. åœ¨ Admin Frontend å³ä¸Šè§’ç‚¹å‡»è¯­è¨€åˆ‡æ¢å™¨
2. ä¾æ¬¡åˆ‡æ¢åˆ°å„ç§è¯­è¨€ï¼š
   - è‹±æ–‡ (en-US)
   - ç®€ä½“ä¸­æ–‡ (zh-CN)
   - å¾·è¯­ (de-DE)
   - æ³•è¯­ (fr-FR)
   - æ—¥è¯­ (ja-JP)
   - ç¹ä½“ä¸­æ–‡ (zh-TW)
3. éªŒè¯æ¯ç§è¯­è¨€ä¸‹ï¼š
   - èœå•ç¿»è¯‘æ­£ç¡®
   - é¡µé¢å†…å®¹ç¿»è¯‘å®Œæ•´
   - æ”¯ä»˜æ¨¡å—æœ¯è¯­å‡†ç¡®

**é¢„æœŸç»“æœï¼š**
- [ ] æ‰€æœ‰è¯­è¨€åˆ‡æ¢æµç•…
- [ ] æ— ç¼ºå¤±ç¿»è¯‘
- [ ] æ ¼å¼æ˜¾ç¤ºæ­£å¸¸

---

## ğŸ” API ç«¯ç‚¹æµ‹è¯•

### ä½¿ç”¨ Swagger UI æµ‹è¯•

è®¿é—®ï¼šhttp://localhost:8000/api/docs

#### æ”¯ä»˜ç³»ç»Ÿ API

**Admin - Subscription Plans:**
- GET `/api/v1/admin/subscription-plans` - è·å–è®¡åˆ’åˆ—è¡¨
- POST `/api/v1/admin/subscription-plans` - åˆ›å»ºè®¡åˆ’
- PUT `/api/v1/admin/subscription-plans/{id}` - æ›´æ–°è®¡åˆ’
- DELETE `/api/v1/admin/subscription-plans/{id}` - åˆ é™¤è®¡åˆ’

**Admin - Payments:**
- GET `/api/v1/admin/payments` - è·å–æ”¯ä»˜è®°å½•
- GET `/api/v1/admin/payments/statistics` - æ”¯ä»˜ç»Ÿè®¡

**Admin - Coupons:**
- GET `/api/v1/admin/coupons` - ä¼˜æƒ åˆ¸åˆ—è¡¨
- POST `/api/v1/admin/coupons` - åˆ›å»ºä¼˜æƒ åˆ¸
- POST `/api/v1/admin/coupons/validate` - éªŒè¯ä¼˜æƒ åˆ¸

**TODO(human): æµ‹è¯•ä»¥ä¸‹ API å¹¶è®°å½•ç»“æœ**
```
æµ‹è¯• Subscription Statistics API:
GET /api/v1/admin/subscriptions/statistics

é¢„æœŸå“åº”åº”åŒ…å«ï¼š
- active_subscriptions: æ•°é‡
- monthly_recurring_revenue: MRR é‡‘é¢
- churn_rate: æµå¤±ç‡
- average_revenue_per_user: ARPU

åœ¨ä¸‹æ–¹è®°å½•å®é™…å“åº”ï¼š
[åœ¨æ­¤ç²˜è´´ JSON å“åº”]

éªŒè¯é¡¹ï¼š
- [ ] æ‰€æœ‰å­—æ®µéƒ½å­˜åœ¨
- [ ] æ•°å€¼ç±»å‹æ­£ç¡®
- [ ] è®¡ç®—é€»è¾‘å‡†ç¡®
```

#### å­£åº¦/å‰§é›† API

**Admin - Seasons:**
- GET `/api/v1/admin/series/{series_id}/seasons` - è·å–å­£åº¦åˆ—è¡¨
- POST `/api/v1/admin/series/{series_id}/seasons` - åˆ›å»ºå­£åº¦
- PUT `/api/v1/admin/seasons/{id}` - æ›´æ–°å­£åº¦
- DELETE `/api/v1/admin/seasons/{id}` - åˆ é™¤å­£åº¦
- POST `/api/v1/admin/seasons/batch-publish` - æ‰¹é‡å‘å¸ƒ

**Admin - Episodes:**
- GET `/api/v1/admin/seasons/{season_id}/episodes` - è·å–å‰§é›†åˆ—è¡¨
- POST `/api/v1/admin/seasons/{season_id}/episodes` - åˆ›å»ºå‰§é›†
- PUT `/api/v1/admin/episodes/{id}/markers` - è®¾ç½®ç‰‡å¤´ç‰‡å°¾æ ‡è®°

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### åç«¯å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
psql -h localhost -p 5434 -U videosite -d videosite -c "SELECT 1;"

# æ£€æŸ¥ Redis è¿æ¥
redis-cli -h localhost -p 6381 ping

# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f backend/logs/app.log
```

### å‰ç«¯æ„å»ºé”™è¯¯
```bash
# æ¸…ç†å¹¶é‡æ–°å®‰è£…
cd admin-frontend
rm -rf node_modules pnpm-lock.yaml
pnpm install

# ç±»å‹æ£€æŸ¥
pnpm run type-check
```

### æ•°æ®åº“è¿ç§»é—®é¢˜
```bash
# æŸ¥çœ‹è¿ç§»å†å²
cd backend
alembic history

# å›æ»šä¸€ä¸ªè¿ç§»
alembic downgrade -1

# å¼ºåˆ¶å‡çº§åˆ°æœ€æ–°
alembic upgrade head
```

---

## âœ… æµ‹è¯•å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰åŸºç¡€è®¾æ–½æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] æ•°æ®åº“è¿ç§»æˆåŠŸ
- [ ] åç«¯æœåŠ¡å¯åŠ¨æ— é”™è¯¯
- [ ] å‰ç«¯æœåŠ¡å¯åŠ¨æ— é”™è¯¯
- [ ] ç®¡ç†å‘˜å¯ä»¥ç™»å½•
- [ ] æ”¯ä»˜è®¡åˆ’ CRUD åŠŸèƒ½æ­£å¸¸
- [ ] ä¼˜æƒ åˆ¸ç®¡ç†åŠŸèƒ½æ­£å¸¸
- [ ] å­£åº¦ç®¡ç†åŠŸèƒ½æ­£å¸¸
- [ ] å‰§é›†ç®¡ç†åŠŸèƒ½æ­£å¸¸
- [ ] å¤šè¯­è¨€åˆ‡æ¢æ­£å¸¸
- [ ] API ç«¯ç‚¹å“åº”æ­£ç¡®
- [ ] æ— æ§åˆ¶å°é”™è¯¯
- [ ] ç”¨æˆ·ä½“éªŒæµç•…

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

å®Œæˆæµ‹è¯•åï¼Œè¯·å¡«å†™æ­¤æ¨¡æ¿ï¼š

```markdown
# æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¥æœŸ:** [æ—¥æœŸ]
**æµ‹è¯•äººå‘˜:** [å§“å]
**æµ‹è¯•ç¯å¢ƒ:** å¼€å‘ç¯å¢ƒ

## åŠŸèƒ½æµ‹è¯•ç»“æœ

### æ”¯ä»˜è®¢é˜…ç³»ç»Ÿ
- è®¢é˜…è®¡åˆ’ç®¡ç†: âœ… / âŒ
- ä¼˜æƒ åˆ¸ç®¡ç†: âœ… / âŒ
- æ”¯ä»˜è®°å½•: âœ… / âŒ
- å‘ç°çš„é—®é¢˜: [åˆ—å‡ºé—®é¢˜]

### å­£åº¦/å‰§é›†ç®¡ç†
- å­£åº¦ CRUD: âœ… / âŒ
- å‰§é›† CRUD: âœ… / âŒ
- æ‰¹é‡æ“ä½œ: âœ… / âŒ
- å‘ç°çš„é—®é¢˜: [åˆ—å‡ºé—®é¢˜]

### å¤šè¯­è¨€æ”¯æŒ
- è¯­è¨€åˆ‡æ¢: âœ… / âŒ
- ç¿»è¯‘å®Œæ•´æ€§: âœ… / âŒ
- å‘ç°çš„é—®é¢˜: [åˆ—å‡ºé—®é¢˜]

## æ€§èƒ½è§‚å¯Ÿ
- é¡µé¢åŠ è½½æ—¶é—´: [è®°å½•]
- API å“åº”æ—¶é—´: [è®°å½•]
- å†…å­˜ä½¿ç”¨: [è®°å½•]

## å»ºè®®æ”¹è¿›
1. [æ”¹è¿›å»ºè®® 1]
2. [æ”¹è¿›å»ºè®® 2]
3. [æ”¹è¿›å»ºè®® 3]
```

---

**ç¥æµ‹è¯•é¡ºåˆ©ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ `/home/eric/video/PAYMENT_SYSTEM_GUIDE.md` è·å–è¯¦ç»†çš„ç³»ç»Ÿæ¶æ„è¯´æ˜ã€‚
