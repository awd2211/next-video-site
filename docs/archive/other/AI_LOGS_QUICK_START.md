# AI 日志系统 - 快速开始指南 ⚡

## 🚀 快速访问

### 1. 启动服务

**后端**（如果还未启动）:
```bash
cd backend
source venv/bin/activate
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**前端**:
```bash
cd admin-frontend
pnpm run dev
```

### 2. 访问页面

**管理后台**: http://localhost:5173

**路径**: 左侧菜单 → "🤖 AI与智能" → "AI日志"

---

## 📋 核心功能速览

### 🔍 请求日志
**用途**: 查看所有 AI API 调用记录

**快捷操作**:
- 选择提供商：OpenAI / Grok / Google
- 选择状态：Success / Failed / Timeout
- 选择日期范围
- 点击"详情"查看完整信息

**关键指标**:
- 总请求数
- 总 Token 数
- 总成本
- 成功率

---

### 💰 成本监控
**用途**: 分析和预测 AI 使用成本

**关键图表**:
1. **成本趋势图**：30天历史趋势
2. **按模型分布**：各模型成本占比
3. **按提供商分布**：各提供商成本占比

**时间范围**: 7天 / 30天 / 90天

---

### ⚙️ 配额管理
**用途**: 控制 AI 使用限额

**配额类型**:
- **全局配额**: 整个系统的总限制
- **用户配额**: 特定用户的限制
- **提供商配额**: 特定提供商的限制

**限制维度**:
- 每日/每月请求数
- 每日/每月 Token 数
- 每日/每月成本
- 每分钟/每小时速率

**创建配额**:
1. 点击"创建配额"
2. 选择配额类型
3. 设置限制值
4. 点击"确定"

---

### 📝 模板管理
**用途**: 管理可重用的 Prompt 模板

**模板分类**:
- 📝 内容生成
- 🔍 内容审核
- 📄 摘要总结
- 🌐 翻译
- 📊 分析

**创建模板**:
1. 点击"创建模板"
2. 填写模板名称和描述
3. 输入 Prompt 模板（支持 `{变量}` 语法）
4. 定义变量（逗号分隔）
5. 设置推荐配置
6. 点击"确定"

**使用变量**:
```
请为视频"{title}"生成一段不超过{max_length}字的描述，内容要包含{keywords}。
```

---

## 🎯 常见场景

### 场景 1: 查看今天的 AI 成本
1. 进入"AI日志" → "成本监控"
2. 查看"今日成本"卡片
3. 如需详细分析，查看成本趋势图

### 场景 2: 限制某个用户的 AI 使用
1. 进入"AI日志" → "配额管理"
2. 点击"创建配额"
3. 选择"用户配额"
4. 输入用户 ID
5. 设置每日/每月限制
6. 点击"确定"

### 场景 3: 创建视频描述生成模板
1. 进入"AI日志" → "模板管理"
2. 点击"创建模板"
3. 填写信息：
   - 名称：视频描述生成器
   - 分类：内容生成
   - Prompt: `为视频"{title}"生成描述`
   - 变量：title
4. 点击"确定"

### 场景 4: 排查失败的 AI 请求
1. 进入"AI日志" → "请求日志"
2. 状态筛选选择"Failed"
3. 点击"过滤"
4. 点击某条记录的"详情"
5. 查看错误信息

---

## 📊 API 文档

### Swagger UI
```
http://localhost:8000/api/docs
```

在 "Admin - AI Logs & Monitoring" 标签下查看所有端点。

### 主要端点

**获取请求日志**:
```bash
curl http://localhost:8000/api/v1/admin/ai-logs/request-logs
```

**获取成本统计**:
```bash
curl http://localhost:8000/api/v1/admin/ai-logs/stats/cost?days=30
```

**获取配额状态**:
```bash
curl http://localhost:8000/api/v1/admin/ai-logs/quotas/status/global
```

---

## 🔧 故障排除

### 问题 1: 页面显示"加载失败"
**原因**: 后端未启动或数据库连接失败

**解决**:
```bash
# 检查后端状态
curl http://localhost:8000/health

# 重启后端
cd backend && source venv/bin/activate
uvicorn app.main:app --reload
```

### 问题 2: 日志列表为空
**原因**: 还没有 AI 请求记录

**解决**:
- 先进行一些 AI 调用（如测试 AI 提供商）
- 或手动创建测试数据

### 问题 3: 翻译显示为键名
**原因**: i18n 文件未正确加载

**解决**:
```bash
# 刷新页面
# 或清除浏览器缓存
```

---

## 💡 使用技巧

### 技巧 1: 成本预警
定期查看"预计月度成本"，如果超出预算，及时调整配额。

### 技巧 2: 性能优化
查看"平均响应时间"，如果过慢，考虑切换到更快的模型。

### 技巧 3: 模板复用
为常用的 AI 任务创建模板，提高工作效率。

### 技巧 4: 错误分析
定期检查失败的请求，找出常见问题并优化。

### 技巧 5: 配额分级
- 普通用户：低配额
- VIP用户：中配额
- 管理员：高配额或无限制

---

## 📚 相关文档

- **完整功能文档**: [AI_LOGS_FEATURE_COMPLETE.md](AI_LOGS_FEATURE_COMPLETE.md)
- **集成说明**: [AI_LOGS_INTEGRATION_COMPLETE.md](AI_LOGS_INTEGRATION_COMPLETE.md)
- **项目说明**: [CLAUDE.md](CLAUDE.md)

---

## 🎉 就是这么简单！

现在你已经可以开始使用 AI 日志和监控系统了。

**记住**:
1. 📊 定期查看成本
2. ⚙️ 合理设置配额
3. 📝 善用模板库
4. 🔍 关注异常日志

祝使用愉快！🚀
