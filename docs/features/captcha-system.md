# 管理员登录验证码功能说明

## 访问地址

管理后台登录页面：**http://localhost:3002/login**

## 功能特性

### 1. 验证码显示
- 页面加载时自动生成验证码图片
- 验证码为 4 位字符（数字+大写字母）
- 图片尺寸：160x60 像素

### 2. 验证码刷新
- **点击验证码图片**即可刷新获取新的验证码
- 登录失败后自动刷新验证码

### 3. 表单验证
- 用户名：必填
- 密码：必填
- 验证码：必填，必须为 4 位字符

### 4. 安全特性
- 验证码不区分大小写
- 验证码一次性使用（验证后自动失效）
- 验证码 5 分钟自动过期
- 登录限流：5 次/分钟

## 登录界面布局

```
┌─────────────────────────────────────┐
│       视频管理后台                    │
│   Video Site Admin Panel            │
├─────────────────────────────────────┤
│  👤 [用户名输入框]                    │
├─────────────────────────────────────┤
│  🔒 [密码输入框]                      │
├─────────────────────────────────────┤
│  🛡️ [验证码输入框] [验证码图片]        │
│     (60%)           (40%)            │
│                     ↑ 点击刷新        │
├─────────────────────────────────────┤
│         [    登   录    ]            │
├─────────────────────────────────────┤
│  默认账号：admin / admin123456        │
│  编辑账号：editor / editor123456      │
└─────────────────────────────────────┘
```

## 测试账号

| 用户名 | 密码 | 权限 |
|--------|------|------|
| admin | admin123456 | 超级管理员 |
| editor | editor123456 | 编辑员 |

## API 端点

### 获取验证码
```http
GET /api/v1/captcha/
Response: PNG 图片
Headers: X-Captcha-ID: {验证码ID}
```

### 管理员登录
```http
POST /api/v1/auth/admin/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123456",
  "captcha_id": "{从响应头获取的ID}",
  "captcha_code": "ABCD"
}
```

## 技术实现

### Backend
- **验证码生成**: Python `captcha` 库
- **存储方式**: Redis（key: captcha:{id}, TTL: 300秒）
- **验证逻辑**: 大小写不敏感，验证后删除

### Frontend
- **UI 组件**: Ant Design
- **验证码显示**: `<img>` 标签 + ObjectURL
- **刷新机制**: 点击事件 + 登录失败自动刷新
- **布局**: `Space.Compact` 组件（验证码输入框 60% + 图片 40%）

## 用户操作流程

1. 打开登录页面 → 自动加载验证码图片
2. 输入用户名、密码
3. 查看验证码图片，输入 4 位验证码
4. 如果看不清，点击图片刷新
5. 点击"登录"按钮
6. 登录成功 → 跳转到管理后台首页
7. 登录失败 → 显示错误信息 + 自动刷新验证码

## 错误提示

| 错误情况 | 提示信息 |
|----------|----------|
| 验证码错误 | "Invalid or expired captcha code" |
| 验证码过期 | "Invalid or expired captcha code" |
| 用户名或密码错误 | "Incorrect username or password" |
| 账号被禁用 | "Admin account is inactive" |
| 请求过于频繁 | 429 Too Many Requests |

## 浏览器访问

现在你可以在浏览器中打开：

**http://localhost:3002/login**

你将看到一个漂亮的登录界面，包含：
- 渐变紫色背景
- 白色卡片式登录框
- 用户名输入框（带用户图标）
- 密码输入框（带锁图标）
- **验证码输入框 + 验证码图片（新增！）**
- 蓝色登录按钮
- 默认账号提示

尝试点击验证码图片，你会看到它自动刷新成新的验证码！
